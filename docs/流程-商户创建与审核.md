# 商户创建 → 管理员审核 → 状态同步 → 移动端展示 流程说明

本文档从前端视角说明该流程能否跑通、每步前端做什么、后端必须满足什么，以及自测清单。

---

## 一、流程概览

```
商户提交酒店 → 管理员审核（通过/不通过）→ 商户看到状态
                    ↓
              商户修改后重新提交 → 管理员看到最新内容 → 再次通过/不通过
                    ↓
              管理员点击「通过」→ 酒店 status=online → 移动端可展示
```

---

## 二、分步说明（前端 + 后端约定）

### 1. 商户上传酒店申请审核

| 角色 | 操作 | 前端行为 | 后端必须 |
|------|------|----------|----------|
| 商户 | 新建酒店，填表单，点「提交审核」 | `POST /hotels`（createHotel），成功跳转「我的酒店」并提示 | 创建记录，`status=pending`，返回 `data.id` |
| 商户 | 在「我的酒店」查看 | `GET /hotels`（fetchMyHotels，带商户 token） | 按当前用户过滤，返回其酒店列表，每条含 `status`（pending/1 等） |
| 前端 | 展示状态 | 用 `normalizeStatus` 显示「待审核」 | 待审核：`pending` / `1` / `0` 均可，前端已兼容 |

**结论**：只要后端 POST /hotels 成功、GET /hotels 按用户返回且带 status，这一步可跑通。

---

### 2. 管理员通过 或 不通过

| 角色 | 操作 | 前端行为 | 后端必须 |
|------|------|----------|----------|
| 管理员 | 打开审核列表 | `GET /hotels/review`（fetchHotelReviewList） | 返回全部酒店，每条含 `id`、`status` 等；列表数组在 `response.data.data` 或兼容格式 |
| 管理员 | 点击「不通过」并填原因 | `POST /hotels/:id/reject`（rejectHotel） | 更新该酒店 `status=rejected`，并保存原因 |
| 管理员 | 点击「通过」 | `POST /hotels/:id/approve`（approveHotel） | 更新该酒店 `status=online`；**:id 必须与列表项 id 一致，不能 404** |

**「通过」按钮何时可点**

- 前端仅在 **已通过** 时禁用「通过」按钮：`status === 'online'` 或 `status === 2` 或 `status === '2'`。
- 若某行显示「审核中」但「通过」仍灰色不可点，说明后端把 **待审核** 的 status 返回成了 `2` 或 `'online'`。  
  **后端约定**：待审核请用 `pending` / `1` / `0`，不要用 `2` 或 `online`。

**结论**：不通过、通过都能跑通的前提是：review 列表 id 与 approve/reject 的 :id 一致且不 404，且 pending 状态不用 2/online。

---

### 3. 商户端要能看到「未通过」

| 角色 | 操作 | 前端行为 | 后端必须 |
|------|------|----------|----------|
| 商户 | 在「我的酒店」查看被拒酒店 | `GET /hotels`（带商户 token） | **同一酒店在管理员执行 reject 后，此接口必须返回更新后的 status（rejected/3）** |
| 前端 | 展示 | `normalizeStatus` 显示「未通过」 | 未通过：`rejected` / `3` / `'3'` 均可 |

**结论**：若管理员点了「不通过」后商户列表仍显示「待审核」，是 **GET /hotels 未返回最新 status**，需后端在 reject 时更新库并在该接口返回新状态。

---

### 4. 商户修改内容后再次提交审核，管理员要看到「重新提交的审核」

| 角色 | 操作 | 前端行为 | 后端必须 |
|------|------|----------|----------|
| 商户 | 编辑酒店，改内容，点「更新并重新提交审核」 | 1）`PUT /hotels/:id`（updateHotel）<br>2）`POST /hotels/:id/status`，body `{ "status": "pending" }`（setHotelStatus） | PUT 更新内容；POST status 将该酒店从 rejected 改为 **pending**（商户仅能改自己的酒店） |
| 管理员 | 打开审核列表 / 筛选「审核中」 | `GET /hotels/review`（可带 status=pending） | 返回所有 pending 酒店，包含商户刚重新提交的，且为最新内容 |

**结论**：前端已实现「更新并重新提交审核」= PUT + POST status pending；管理员端 GET /hotels/review?status=pending 可看到重新提交的待审核酒店。

---

### 5. 通过之后能不能推送到移动端？

| 环节 | 说明 |
|------|------|
| 前端 | 管理员点击「通过」→ 调用 `POST /hotels/:id/approve`，成功后提示「已通过审核，酒店已上线，移动端将展示该酒店。」 |
| 后端 | 收到 approve 后，将该酒店 **status 置为 online**，并持久化。 |
| 移动端 | 列表/详情接口只查 **status=online** 的酒店；后端已把该酒店设为 online，移动端下次请求即可拿到并展示。 |

**结论**：  
- **前端**：只负责调 approve 接口，不负责「推送到移动端」。  
- **推送到移动端**：由 **后端 + 移动端** 约定完成——后端在 approve 时把 status 设为 online，移动端用「只展示 online 酒店」的接口即可。只要后端按此实现，通过后就能在移动端展示。

---

## 三、自测清单（按顺序跑一遍）

- [ ] **商户**：新建酒店，提交审核 → 列表中出现该酒店，状态「待审核」。
- [ ] **管理员**：审核列表能看到该酒店，状态「审核中」；点击「通过」可点且成功 → 该行变为「通过」。
- [ ] **管理员**：对另一家点「不通过」并填原因 → 该行变为「不通过」。
- [ ] **商户**：刷新「我的酒店」→ 被拒的那家显示「未通过」，通过的那家显示「已上线」。
- [ ] **商户**：编辑被拒酒店，修改名称/房型等，点「更新并重新提交审核」→ 提示成功。
- [ ] **管理员**：审核列表刷新/筛选「审核中」→ 能看到该酒店且为 **最新修改内容**，状态为「审核中」，可再次点「通过」或「不通过」。
- [ ] **管理员**：再次点「通过」→ 成功；**移动端**（若已接好）列表/详情能出现该酒店。

若某一步失败，对照上表看是前端接口没调对，还是后端未满足「后端必须」一列。

---

## 四、前端状态约定（与 api_pc 一致）

- 待审核：`pending` / `1` / `0`
- 已上线：`online` / `2` / `'2'`
- 未通过：`rejected` / `3` / `'3'`
- 已下线：`offline` / `4` / `'4'`

审核列表、商户列表、编辑页状态展示与「通过/不通过/下线」按钮的禁用逻辑均已按上述约定实现；若后端用数字，只要在上述范围内即可正确显示和操作。

---

## 五、后端核对（已满足的约定）

以下为后端按「后端必须」逐条核对结果，**流程可跑通**。

| 步骤 | 后端必须 | 后端实现 |
|------|----------|----------|
| 1 | 创建时 status=pending；GET /hotels 按当前用户过滤并返回带 status | ✅ POST /hotels 写入 `status=0`（pending）；GET /hotels 带商户 token 时按 `user_id` 过滤，列表项含 `status`（字符串） |
| 2 | review 列表含 id、status；approve/reject 的 :id 与列表一致不 404；待审核不用 2/online | ✅ GET /hotels/review 返回 `id`、`status`（**统一字符串**：`pending`/`online`/`rejected`/`offline`）；approve/reject 仅按 id 更新；管理员 GET /hotels/:id 任意状态可查 |
| 3 | reject 后商户 GET /hotels 返回该酒店最新 status=rejected | ✅ reject 将库中 status 置为 3；商户 GET /hotels 查该 user_id 且不筛 status，返回 `status: 'rejected'` |
| 4 | PUT 更新内容；POST status 可把 rejected 改为 pending；review?status=pending 含重新提交的 | ✅ PUT /hotels/:id 只更新内容不强制改 status；商户可调 POST /hotels/:id/status `{ "status": "pending" }`（仅本人）；GET /hotels/review?status=pending 返回所有 pending，含最新内容 |
| 5 | approve 后 status=online；移动端只查 online 的酒店 | ✅ approve 将 status 置为 1（online）；移动端 GET /hotels 无 token 时只查 `status=1`，通过后即展示 |

**后端状态约定（与前端对齐）**

- 接口中 **status 统一返回字符串**：`pending` | `online` | `offline` | `rejected`，避免数字与前端「1=待审核、2=已上线」等约定混淆。
- 待审核在接口中为 `pending`，**不会**返回 `2` 或 `online`，故「通过」按钮在待审核时可点。
- 前端已兼容字符串与数字两种返回，当前后端采用字符串即可。
